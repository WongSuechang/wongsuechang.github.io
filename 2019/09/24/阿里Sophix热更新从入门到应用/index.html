<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>阿里Sophix热更新从入门到应用 | WongSuechang&#39;s Blogs</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="android学习,app开发">
    <meta name="description" content="1.引言&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;用户在某些情况下不愿意手动点击更新，同时产品提出公司App做到无感修复更新。综合考虑各大厂商热更新方案，倾向于阿里的Sophix方案，原因如下： 1. so文件替换更新 2. 资源文件替换 3. 尽量可以做到实时修复&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbs">
<meta name="keywords" content="android学习,app开发">
<meta property="og:type" content="article">
<meta property="og:title" content="阿里Sophix热更新从入门到应用">
<meta property="og:url" content="http://wongsuechang.github.io/2019/09/24/阿里Sophix热更新从入门到应用/index.html">
<meta property="og:site_name" content="WongSuechang&#39;s Blogs">
<meta property="og:description" content="1.引言&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;用户在某些情况下不愿意手动点击更新，同时产品提出公司App做到无感修复更新。综合考虑各大厂商热更新方案，倾向于阿里的Sophix方案，原因如下： 1. so文件替换更新 2. 资源文件替换 3. 尽量可以做到实时修复&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbs">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://wongsuechang.github.io/images/hot_fix.png">
<meta property="og:updated_time" content="2019-10-12T09:41:00.114Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="阿里Sophix热更新从入门到应用">
<meta name="twitter:description" content="1.引言&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;用户在某些情况下不愿意手动点击更新，同时产品提出公司App做到无感修复更新。综合考虑各大厂商热更新方案，倾向于阿里的Sophix方案，原因如下： 1. so文件替换更新 2. 资源文件替换 3. 尽量可以做到实时修复&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbs">
<meta name="twitter:image" content="http://wongsuechang.github.io/images/hot_fix.png">
    
        <link rel="alternate" type="application/atom+xml" title="WongSuechang&#39;s Blogs" href="/atom.xml">
    
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/wongsuechang.png">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Wong Suechang</h5>
          <a href="mailto:semp@live.cn" title="semp@live.cn" class="mail">semp@live.cn</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                文章
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                标签
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/关于我"  >
                <i class="icon icon-lg icon-th-list"></i>
                关于我
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/wongsuechang" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">阿里Sophix热更新从入门到应用</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">阿里Sophix热更新从入门到应用</h1>
        <h5 class="subtitle">
            
                <time datetime="2019-09-24T09:59:49.000Z" itemprop="datePublished" class="page-time">
  2019-09-24
</time>


            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-引言"><span class="post-toc-number">1.</span> <span class="post-toc-text">1.引言</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2、集成准备"><span class="post-toc-number">2.</span> <span class="post-toc-text">2、集成准备</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-1-android-studio集成"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">2.1 android studio集成</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-2-权限"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">2.2 权限</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-3-AndroidManifest文件配置"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">2.3 AndroidManifest文件配置</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-4-混淆配置"><span class="post-toc-number">2.4.</span> <span class="post-toc-text">2.4 混淆配置</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-SDK接口使用说明"><span class="post-toc-number">3.</span> <span class="post-toc-text">3 SDK接口使用说明</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-1-接入范例"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">3.1 接入范例</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-2-接口说明"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">3.2 接口说明</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#3-2-1-initialize方法"><span class="post-toc-number">3.2.1.</span> <span class="post-toc-text">3.2.1 initialize方法</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#3-2-2-queryAndLoadNewPatch方法"><span class="post-toc-number">3.2.2.</span> <span class="post-toc-text">3.2.2 queryAndLoadNewPatch方法</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#3-2-3-killProcessSafely方法"><span class="post-toc-number">3.2.3.</span> <span class="post-toc-text">3.2.3 killProcessSafely方法</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#3-2-4-cleanPatches-方法"><span class="post-toc-number">3.2.4.</span> <span class="post-toc-text">3.2.4 cleanPatches()方法</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#3-2-5-PatchLoadStatusListener接口"><span class="post-toc-number">3.2.5.</span> <span class="post-toc-text">3.2.5 PatchLoadStatusListener接口</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#3-2-6-setTags接口"><span class="post-toc-number">3.2.6.</span> <span class="post-toc-text">3.2.6 setTags接口</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-版本管理说明"><span class="post-toc-number">4.</span> <span class="post-toc-text">4 版本管理说明</span></a></li></ol>
        </nav>
    </aside>


<article id="post-阿里Sophix热更新从入门到应用"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">阿里Sophix热更新从入门到应用</h1>
        <div class="post-meta">
            <time class="post-time" title="2019-09-24 17:59:49" datetime="2019-09-24T09:59:49.000Z"  itemprop="datePublished">2019-09-24</time>

            


            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h3 id="1-引言"><a href="#1-引言" class="headerlink" title="1.引言"></a>1.引言<br></h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;用户在某些情况下不愿意手动点击更新，同时产品提出公司App做到无感修复更新。综合考虑各大厂商热更新方案，倾向于阿里的Sophix方案，原因如下：</p>
<pre><code>1. so文件替换更新
2. 资源文件替换
3. 尽量可以做到实时修复</code></pre><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sophix修复方案加分项： ①支持加密传输和签名校验； ②性能损耗低； ③接入开发成本低； ④价格合适。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="../../../../images/hot_fix.png" alt="image" title>
                </div>
                <div class="image-caption">image</div>
            </figure>
<h3 id="2、集成准备"><a href="#2、集成准备" class="headerlink" title="2、集成准备"></a>2、集成准备<br></h3><h4 id="2-1-android-studio集成"><a href="#2-1-android-studio集成" class="headerlink" title="2.1 android studio集成"></a>2.1 android studio集成<br></h4><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gradle远程仓库依赖, 打开项目找到app的build.gradle文件，添加如下配置：<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;添加maven仓库地址：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">repositories &#123;</span><br><span class="line">    maven &#123;</span><br><span class="line">        url &quot;http://maven.aliyun.com/nexus/content/repositories/releases&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;添加gradle坐标版本依赖：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile &apos;com.aliyun.ams:alicloud-android-hotfix:3.2.8&apos;</span><br></pre></td></tr></table></figure>

<p><strong>注意：使用android studio打包生成apk时，要关闭instant run。</strong></p>
<h4 id="2-2-权限"><a href="#2-2-权限" class="headerlink" title="2.2 权限"></a>2.2 权限<br></h4><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sophix SDK使用到以下权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;! -- 网络权限 --&gt;</span><br><span class="line">&lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;</span><br><span class="line">&lt;uses-permission android:name=&quot;android.permission.ACCESS_NETWORK_STATE&quot; /&gt;</span><br><span class="line">&lt;uses-permission android:name=&quot;android.permission.ACCESS_WIFI_STATE&quot; /&gt;</span><br><span class="line">&lt;! -- 外部存储读权限，调试工具加载本地补丁需要 --&gt;</span><br><span class="line">&lt;uses-permission android:name=&quot;android.permission.READ_EXTERNAL_STORAGE&quot;/&gt;</span><br></pre></td></tr></table></figure>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ_EXTERNAL_STORAGE权限属于Dangerous Permissions，仅调试工具获取外部补丁需要，不影响线上发布的补丁加载，调试时请自行做好android6.0以上的运行时权限获取。</p>
<h4 id="2-3-AndroidManifest文件配置"><a href="#2-3-AndroidManifest文件配置" class="headerlink" title="2.3 AndroidManifest文件配置"></a>2.3 AndroidManifest文件配置<br></h4><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在 <strong>AndroidManifest.xml</strong> 中间的 <strong>application</strong>节点下添加如下配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta-data</span><br><span class="line">android:name=&quot;com.taobao.android.hotfix.IDSECRET&quot;</span><br><span class="line">android:value=&quot;App ID&quot; /&gt;</span><br><span class="line">&lt;meta-data</span><br><span class="line">android:name=&quot;com.taobao.android.hotfix.APPSECRET&quot;</span><br><span class="line">android:value=&quot;App Secret&quot; /&gt;</span><br><span class="line">&lt;meta-data</span><br><span class="line">android:name=&quot;com.taobao.android.hotfix.RSASECRET&quot;</span><br><span class="line">android:value=&quot;RSA密钥&quot; /&gt;</span><br></pre></td></tr></table></figure>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;将上述value中的值分别改为通过平台HotFix服务申请得到的App Secret和RSA密钥，出于安全考虑，建议使用setSecretMetaData这个方法进行设置。<br><br><strong>另外，热修复暂不支持EMAS统一插件的json文件读取。</strong></p>
<h4 id="2-4-混淆配置"><a href="#2-4-混淆配置" class="headerlink" title="2.4 混淆配置"></a>2.4 混淆配置<br></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#基线包使用，生成mapping.txt</span><br><span class="line">-printmapping mapping.txt</span><br><span class="line">#生成的mapping.txt在app/build/outputs/mapping/release路径下，移动到/app路径下</span><br><span class="line">#修复后的项目使用，保证混淆结果一致</span><br><span class="line">#-applymapping mapping.txt</span><br><span class="line">#hotfix</span><br><span class="line">-keep class com.taobao.sophix.**&#123;*;&#125;</span><br><span class="line">-keep class com.ta.utdid2.device.**&#123;*;&#125;</span><br><span class="line">-dontwarn com.alibaba.sdk.android.utils.**</span><br><span class="line">#防止inline</span><br><span class="line">-dontoptimize</span><br></pre></td></tr></table></figure>

<h3 id="3-SDK接口使用说明"><a href="#3-SDK接口使用说明" class="headerlink" title="3 SDK接口使用说明"></a>3 SDK接口使用说明<br></h3><h4 id="3-1-接入范例"><a href="#3-1-接入范例" class="headerlink" title="3.1 接入范例"></a>3.1 接入范例</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initialize的调用应该尽可能的早，必须在Application.attachBaseContext()的最开始（在super.attachBaseContext之后，如果有Multidex，也需要在Multidex.install之后）进行SDK初始化操作，初始化之前不能用到其他自定义类，否则极有可能导致崩溃。而查询服务器是否有可用补丁的操作可以在后面的任意地方。不建议在Application.onCreate()中初始化，因为如果带有ContentProvider，就会使得Sophix初始化时机太迟从而引发问题。<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;从app稳定性角度考虑，我们应采用稳健接入方式。原来的初始化方式虽然可以使用，但新方式可以提供更全面的功能修复支持。新的初始化方式带来如下有点：<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1.初始化与应用原先业务代码完全隔离，使得原先真正的Application可以修复；<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.减少了补丁预加载时间；<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.更完美地兼容Android 8.0以后版本。<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;具体接入，需要用到以下这个类：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">package com.machinsight.dcollision;</span><br><span class="line">import android.app.Application;</span><br><span class="line">import android.content.Context;</span><br><span class="line">import android.support.annotation.Keep;</span><br><span class="line">import android.util.Log;</span><br><span class="line">import com.taobao.sophix.PatchStatus;</span><br><span class="line">import com.taobao.sophix.SophixApplication;</span><br><span class="line">import com.taobao.sophix.SophixEntry;</span><br><span class="line">import com.taobao.sophix.SophixManager;</span><br><span class="line">import com.taobao.sophix.listener.PatchLoadStatusListener;</span><br><span class="line">import com.my.pkg.MyRealApplication;</span><br><span class="line">/**</span><br><span class="line"> * Sophix入口类，专门用于初始化Sophix，不应包含任何业务逻辑。</span><br><span class="line"> * 此类必须继承自SophixApplication，onCreate方法不需要实现。</span><br><span class="line"> * 此类不应与项目中的其他类有任何互相调用的逻辑，必须完全做到隔离。</span><br><span class="line"> * AndroidManifest中设置application为此类，而SophixEntry中设为原先Application类。</span><br><span class="line"> * 注意原先Application里不需要再重复初始化Sophix，并且需要避免混淆原先Application类。</span><br><span class="line"> * 如有其它自定义改造，请咨询官方后妥善处理。</span><br><span class="line"> */</span><br><span class="line">public class SophixStubApplication extends SophixApplication &#123;</span><br><span class="line">    private final String TAG = &quot;SophixStubApplication&quot;;</span><br><span class="line">    // 此处SophixEntry应指定真正的Application，并且保证RealApplicationStub类名不被混淆。</span><br><span class="line">    @Keep</span><br><span class="line">    @SophixEntry(MyRealApplication.class)</span><br><span class="line">    static class RealApplicationStub &#123;&#125;</span><br><span class="line">    @Override</span><br><span class="line">    protected void attachBaseContext(Context base) &#123;</span><br><span class="line">        super.attachBaseContext(base);</span><br><span class="line">//         如果需要使用MultiDex，需要在此处调用。</span><br><span class="line">//         MultiDex.install(this);</span><br><span class="line">        initSophix();</span><br><span class="line">    &#125;</span><br><span class="line">    private void initSophix() &#123;</span><br><span class="line">        String appVersion = &quot;0.0.0&quot;;</span><br><span class="line">        try &#123;</span><br><span class="line">            appVersion = this.getPackageManager()</span><br><span class="line">                             .getPackageInfo(this.getPackageName(), 0)</span><br><span class="line">                             .versionName;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        final SophixManager instance = SophixManager.getInstance();</span><br><span class="line">        instance.setContext(this)</span><br><span class="line">                .setAppVersion(appVersion)</span><br><span class="line">                .setSecretMetaData(null, null, null)</span><br><span class="line">                .setEnableDebug(true)</span><br><span class="line">                .setEnableFullLog()</span><br><span class="line">                .setPatchLoadStatusStub(new PatchLoadStatusListener() &#123;</span><br><span class="line">                    @Override</span><br><span class="line">                    public void onLoad(final int mode, final int code, final String info, final int handlePatchVersion) &#123;</span><br><span class="line">                        if (code == PatchStatus.CODE_LOAD_SUCCESS) &#123;</span><br><span class="line">                            Log.i(TAG, &quot;sophix load patch success!&quot;);</span><br><span class="line">                        &#125; else if (code == PatchStatus.CODE_LOAD_RELAUNCH) &#123;</span><br><span class="line">                            // 如果需要在后台重启，建议此处用SharePreference保存状态。</span><br><span class="line">                            Log.i(TAG, &quot;sophix preload patch success. restart app to make effect.&quot;);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;).initialize();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// queryAndLoadNewPatch不可放在attachBaseContext 中，否则无网络权限，建议放在后面任意时刻，如onCreate中</span><br><span class="line">SophixManager.getInstance().queryAndLoadNewPatch();</span><br></pre></td></tr></table></figure>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;其中关键一点：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@Keep</span><br><span class="line">@SophixEntry(MyRealApplication.class)</span><br><span class="line">static class RealApplicationStub &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SophixEntry应指定项目中原先真正的Application（原项目里application的android::name指定的），这里用MyRealApplication指代。并且保证RealApplicationStub类名不被混淆。而SophixStubApplication的类名和包名可以自行取名。<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;这里的Keep是android.support包中的类，目的是为了防止这个内部静态类的类名被混淆，因为sophix内部会反射获取这个类的SophixEntry。如果项目中没有依赖android.support的话，就需要在progurad里面手动指定RealApplicationStub不被混淆，详见下文。<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;然后，在proguard文件里面需要加上下面内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-keepclassmembers class com.my.pkg.MyRealApplication &#123;</span><br><span class="line">    public &lt;init&gt;();</span><br><span class="line">&#125;</span><br><span class="line"># 如果不使用android.support.annotation.Keep则需加上此行</span><br><span class="line"># -keep class com.my.pkg.SophixStubApplication$RealApplicationStub</span><br></pre></td></tr></table></figure>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;目的是防止真正Application的构造方法被proguard混淆。<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;最后，需要把AndroidManifest里面的application改为这个新增的SophixStubApplication类：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;application</span><br><span class="line">    android:name=&quot;com.my.pkg.SophixStubApplication&quot;</span><br><span class="line">    ... ...&gt;</span><br><span class="line">    ... ...</span><br></pre></td></tr></table></figure>

<p>总结一下，过程一共有四个步骤：<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1.把此SophixStubApplication入口类添加进项目中，所有Sophix相关初始化放在此类中。并且不应包含开发者的任何业务逻辑代码。若使用了MultiDex，也应在SophixStubApplication的initSophix之前添加，并且需要记得在原来的Application里面去除MultiDex，避免重复调用导致问题。<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.把RealApplicationStub的SophixEntry注解的内容改为自己原先真正的MyRealApplication类。<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.混淆文件中确保某些内容不被混淆。<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4.AndroidManifest里面的application改为新增的SophixStubApplication入口类。<br></p>
<h4 id="3-2-接口说明"><a href="#3-2-接口说明" class="headerlink" title="3.2 接口说明"></a>3.2 接口说明<br></h4><h5 id="3-2-1-initialize方法"><a href="#3-2-1-initialize方法" class="headerlink" title="3.2.1 initialize方法"></a>3.2.1 initialize方法<br></h5><ul>
<li><p>initialize(): &lt;必选&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;该方法主要做些必要的初始化工作以及如果本地有补丁的话会加载补丁, 但不会自动请求补丁。因此需要自行调用queryAndLoadNewPatch方法拉取补丁。这个方法调用需要尽可能的早, 必须在Application的attachBaseContext方法的最前面调用（在super.attachBaseContext之后，如果有Multidex，也需要在Multidex.install之后）, initialize()方法调用之前你需要先调用如下几个方法进行一些必要的参数设置, 方法调用说明如下:</p>
</li>
<li><p>setContext(application): &lt;必选&gt; 传入入口Application即可</p>
</li>
<li><p>setAppVersion(appVersion): &lt;必选&gt; 应用的版本号</p>
</li>
<li><p>setSecretMetaData(idSecret, appSecret, rsaSecret): &lt;可选，推荐使用&gt; 三个Secret分别对应AndroidManifest里面的三个，可以不在AndroidManifest设置而是用此函数来设置Secret。放到代码里面进行设置可以自定义混淆代码，更加安全，此函数的设置会覆盖AndroidManifest里面的设置，如果对应的值设为null，默认会在使用AndroidManifest里面的。</p>
</li>
<li><p>setEnableDebug(isEnabled): &lt;可选&gt; isEnabled默认为false, 是否调试模式, 调试模式下会输出日志以及不进行补丁签名校验. 线下调试此参数可以设置为true, 查看日志过滤TAG:Sophix, 同时强制不对补丁进行签名校验, 所有就算补丁未签名或者签名失败也发现可以加载成功. 但是正式发布该参数必须为false, false会对补丁做签名校验, 否则就可能存在安全漏洞风险</p>
</li>
<li><p>setAesKey(aesKey): &lt;可选&gt; 用户自定义aes秘钥, 会对补丁包采用对称加密。这个参数值必须是16位数字或字母的组合，是和补丁工具设置里面AES Key保持完全一致, 补丁才能正确被解密进而加载。此时平台无感知这个秘钥, 所以不用担心阿里云移动平台会利用你们的补丁做一些非法的事情。</p>
</li>
<li><p>setPatchLoadStatusStub(new PatchLoadStatusListener()): &lt;可选&gt; 设置patch加载状态监听器, 该方法参数需要实现PatchLoadStatusListener接口, 接口说明见3.2.说明</p>
</li>
<li><p>setUnsupportedModel(modelName, sdkVersionInt):&lt;可选&gt; 把不支持的设备加入黑名单，加入后不会进行热修复。modelName为该机型上Build.MODEL的值，这个值也可以通过adb shell getprop | grep ro.product.model取得。sdkVersionInt就是该机型的Android版本，也就是Build.VERSION.SDK_INT，若设为0，则对应该机型所有安卓版本。目前控制台也可以直接设置机型黑名单，更加灵活。</p>
</li>
</ul>
<h5 id="3-2-2-queryAndLoadNewPatch方法"><a href="#3-2-2-queryAndLoadNewPatch方法" class="headerlink" title="3.2.2 queryAndLoadNewPatch方法"></a>3.2.2 queryAndLoadNewPatch方法</h5><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;该方法主要用于查询服务器是否有新的可用补丁. SDK内部限制连续两次queryAndLoadNewPatch()方法调用不能短于3s, 否则的话就会报code:19的错误码. 如果查询到可用的话, 首先下载补丁到本地。</p>
<ul>
<li><p>应用原本没有补丁, 那么如果当前应用的补丁是热补丁, 那么会立刻加载(不管是冷补丁还是热补丁). 如果当前应用的补丁是冷补丁, 那么需要重启生效.</p>
</li>
<li><p><strong>应用已经存在一个补丁, 请求发现有新补丁后，本次不受影响。并且在下次启动时补丁文件删除, 下载并预加载新补丁。在下下次启动时应用新补丁。</strong> 补丁在后台发布之后, 并不会主动下行推送到客户端, 需要手动调用queryAndLoadNewPatch方法查询后台补丁是否可用.</p>
</li>
<li><p>只会下载补丁版本号比当前应用存在的补丁版本号高的补丁, 比如当前应用已经下载了补丁版本号为5的补丁, 那么只有后台发布的补丁版本号&gt;5才会重新下载.</p>
<p>同时1.4.0以上版本服务后台上线了“一键清除”补丁的功能, 所以如果后台点击了“一键清除”那么这个方法将会返回code:18的状态码. 此时本地补丁将会被强制清除, 同时不清除本地补丁版本号</p>
</li>
</ul>
<h5 id="3-2-3-killProcessSafely方法"><a href="#3-2-3-killProcessSafely方法" class="headerlink" title="3.2.3 killProcessSafely方法"></a>3.2.3 killProcessSafely方法</h5><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;可以在PatchLoadStatusListener监听到CODE_LOAD_RELAUNCH后在合适的时机，调用此方法杀死进程。注意，不可以直接Process.killProcess(Process.myPid())来杀进程，这样会扰乱Sophix的内部状态。因此如果需要杀死进程，建议使用这个方法，它在内部做一些适当处理后才杀死本进程。</p>
<h5 id="3-2-4-cleanPatches-方法"><a href="#3-2-4-cleanPatches-方法" class="headerlink" title="3.2.4 cleanPatches()方法"></a>3.2.4 cleanPatches()方法</h5><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;清空本地补丁，并且不再拉取被清空的版本的补丁。正常情况下不需要开发者自己调用，因为Sophix内部会判断对补丁引发崩溃的情况进行自动清空。</p>
<h5 id="3-2-5-PatchLoadStatusListener接口"><a href="#3-2-5-PatchLoadStatusListener接口" class="headerlink" title="3.2.5 PatchLoadStatusListener接口"></a>3.2.5 PatchLoadStatusListener接口</h5><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;该接口需要自行实现并传入initialize方法中, 补丁加载状态会回调给该接口, 参数说明如下:</p>
<ul>
<li>mode: 无实际意义, 为了兼容老版本, 默认始终为0</li>
<li>code: 补丁加载状态码, 详情查看PatchStatus类说明</li>
<li>info: 补丁加载详细说明</li>
<li>handlePatchVersion: 当前处理的补丁版本号, 0:无 -1:本地补丁 其它:后台补丁<br>常见状态码说明如下: 一个补丁的加载一般分为三个阶段: 查询/预加载/加载<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">//兼容老版本的code说明</span><br><span class="line">    int CODE_LOAD_SUCCESS = 1;//加载阶段, 成功</span><br><span class="line">    int CODE_ERR_INBLACKLIST = 4;//加载阶段, 失败设备不支持</span><br><span class="line">    int CODE_REQ_NOUPDATE = 6;//查询阶段, 没有发布新补丁</span><br><span class="line">    int CODE_REQ_NOTNEWEST = 7;//查询阶段, 补丁不是最新的</span><br><span class="line">    int CODE_DOWNLOAD_SUCCESS = 9;//查询阶段, 补丁下载成功</span><br><span class="line">    int CODE_DOWNLOAD_BROKEN = 10;//查询阶段, 补丁文件损坏下载失败</span><br><span class="line">    int CODE_UNZIP_FAIL = 11;//查询阶段, 补丁解密失败</span><br><span class="line">    int CODE_LOAD_RELAUNCH = 12;//预加载阶段, 需要重启</span><br><span class="line">    int CODE_REQ_APPIDERR = 15;//查询阶段, appid异常</span><br><span class="line">    int CODE_REQ_SIGNERR = 16;//查询阶段, 签名异常</span><br><span class="line">    int CODE_REQ_UNAVAIABLE = 17;//查询阶段, 系统无效</span><br><span class="line">    int CODE_REQ_SYSTEMERR = 22;//查询阶段, 系统异常</span><br><span class="line">    int CODE_REQ_CLEARPATCH = 18;//查询阶段, 一键清除补丁</span><br><span class="line">    int CODE_PATCH_INVAILD = 20;//加载阶段, 补丁格式非法</span><br><span class="line">    //查询阶段的code说明</span><br><span class="line">    int CODE_QUERY_UNDEFINED = 31;//未定义异常</span><br><span class="line">    int CODE_QUERY_CONNECT = 32;//连接异常</span><br><span class="line">    int CODE_QUERY_STREAM = 33;//流异常</span><br><span class="line">    int CODE_QUERY_EMPTY = 34;//请求空异常</span><br><span class="line">    int CODE_QUERY_BROKEN = 35;//请求完整性校验失败异常</span><br><span class="line">    int CODE_QUERY_PARSE = 36;//请求解析异常</span><br><span class="line">    int CODE_QUERY_LACK = 37;//请求缺少必要参数异常</span><br><span class="line">    //预加载阶段的code说明</span><br><span class="line">    int CODE_PRELOAD_SUCCESS = 100;//预加载成功</span><br><span class="line">    int CODE_PRELOAD_UNDEFINED = 101;//未定义异常</span><br><span class="line">    int CODE_PRELOAD_HANDLE_DEX = 102;//dex加载异常</span><br><span class="line">    int CODE_PRELOAD_NOT_ZIP_FORMAT = 103;//基线dex非zip格式异常</span><br><span class="line">    int CODE_PRELOAD_REMOVE_BASEDEX = 105;//基线dex处理异常</span><br><span class="line">    //加载阶段的code说明 分三部分dex加载, resource加载, lib加载</span><br><span class="line">    //dex加载</span><br><span class="line">    int CODE_LOAD_UNDEFINED = 71;//未定义异常</span><br><span class="line">    int CODE_LOAD_AES_DECRYPT = 72;//aes对称解密异常</span><br><span class="line">    int CODE_LOAD_MFITEM = 73;//补丁SOPHIX.MF文件解析异常</span><br><span class="line">    int CODE_LOAD_COPY_FILE = 74;//补丁拷贝异常</span><br><span class="line">    int CODE_LOAD_SIGNATURE = 75;//补丁签名校验异常</span><br><span class="line">    int CODE_LOAD_SOPHIX_VERSION = 76;//补丁和补丁工具版本不一致异常</span><br><span class="line">    int CODE_LOAD_NOT_ZIP_FORMAT = 77;//补丁zip解析异常</span><br><span class="line">    int CODE_LOAD_DELETE_OPT = 80;//删除无效odex文件异常</span><br><span class="line">    int CODE_LOAD_HANDLE_DEX = 81;//加载dex异常</span><br><span class="line">    // 反射调用异常</span><br><span class="line">    int CODE_LOAD_FIND_CLASS = 82;</span><br><span class="line">    int CODE_LOAD_FIND_CONSTRUCTOR = 83;</span><br><span class="line">    int CODE_LOAD_FIND_METHOD = 84;</span><br><span class="line">    int CODE_LOAD_FIND_FIELD = 85;</span><br><span class="line">    int CODE_LOAD_ILLEGAL_ACCESS = 86;</span><br><span class="line">    //resource加载</span><br><span class="line">    public static final int CODE_LOAD_RES_ADDASSERTPATH = 123;//新增资源补丁包异常</span><br><span class="line">    //lib加载</span><br><span class="line">    int CODE_LOAD_LIB_UNDEFINED = 131;//未定义异常</span><br><span class="line">    int CODE_LOAD_LIB_CPUABIS = 132;//获取primaryCpuAbis异常</span><br><span class="line">    int CODE_LOAD_LIB_JSON = 133;//json格式异常</span><br><span class="line">    int CODE_LOAD_LIB_LOST = 134;//lib库不完整异常</span><br><span class="line">    int CODE_LOAD_LIB_UNZIP = 135;//解压异常</span><br><span class="line">    int CODE_LOAD_LIB_INJECT = 136;//注入异常</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h5 id="3-2-6-setTags接口"><a href="#3-2-6-setTags接口" class="headerlink" title="3.2.6 setTags接口"></a>3.2.6 setTags接口</h5><p>该参数设置端上拉取补丁包时的标签，可以支持条件更为丰富的灰度发布，以下为简单示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; tags = new ArrayList&lt;&gt;();</span><br><span class="line">tags.add(&quot;test&quot;);</span><br><span class="line">//此处调用在queryAndLoadNewPatch()方法前</span><br><span class="line">SophixManager.getInstance().setTags(tags)；</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; tags = new ArrayList&lt;&gt;();</span><br><span class="line">tags.add(&quot;production&quot;);</span><br><span class="line">//此处调用在queryAndLoadNewPatch()方法前</span><br><span class="line">SophixManager.getInstance().setTags(tags)；</span><br></pre></td></tr></table></figure>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;如上，设置不同的tags，同一版本号下，可以打两个或者多个基线包，线上发布时用production的基线包，测试环境用test的基线包，这样就可以测试同一版本号下的同一个补丁了，两个环境互不影响。tags可以add多个，结构为前后非空字符串即可。生成补丁时，用同样tags的基线包和修复包。</p>
<h3 id="4-版本管理说明"><a href="#4-版本管理说明" class="headerlink" title="4 版本管理说明"></a>4 版本管理说明</h3><p><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;说明一：patch是针对客户端具体某个版本的，patch和具体版本绑定<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - 应用当前版本号是1.1.0, 那么只能在后台查询到1.1.0版本对应发布的补丁, 而查询不到之前1.0.0旧版本发布的补丁.<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;说明二：针对某个具体版本发布的新补丁, 必须包含所有的bugfix, 而不能依赖补丁递增修复的方式, 因为应用仅可能加载一个补丁<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - 针对1.0.0版本在后台发布了一个补丁版本号为1的补丁修复了bug1, 然后发现此时针对这个版本补丁1修复的不完全, 代码还有bug2, 在后台重新发布一个补丁版本号为2的补丁, 那么此时补丁2就必须同时包含bug1和bug2的修复才行, 而不是只包含bug2的修复(bug1就没被修复了)</p>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2019-10-12T09:41:00.114Z" itemprop="dateUpdated">2019-10-12 17:41:00</time>
</span><br>


        
        <a href="/2019/09/24/阿里Sophix热更新从入门到应用/" target="_blank" rel="external">http://wongsuechang.github.io/2019/09/24/阿里Sophix热更新从入门到应用/</a>
        
    </div>
    
    <footer>
        <a href="http://wongsuechang.github.io">
            <img src="/img/wongsuechang.png" alt="Wong Suechang">
            Wong Suechang
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android学习/">android学习</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/app开发/">app开发</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://wongsuechang.github.io/2019/09/24/阿里Sophix热更新从入门到应用/&title=《阿里Sophix热更新从入门到应用》 — WongSuechang's Blogs&pic=http://wongsuechang.github.io/img/wongsuechang.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://wongsuechang.github.io/2019/09/24/阿里Sophix热更新从入门到应用/&title=《阿里Sophix热更新从入门到应用》 — WongSuechang's Blogs&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://wongsuechang.github.io/2019/09/24/阿里Sophix热更新从入门到应用/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《阿里Sophix热更新从入门到应用》 — WongSuechang's Blogs&url=http://wongsuechang.github.io/2019/09/24/阿里Sophix热更新从入门到应用/&via=http://wongsuechang.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://wongsuechang.github.io/2019/09/24/阿里Sophix热更新从入门到应用/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2020/03/23/美团配送数据治理实践/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">美团配送数据治理实践</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2019/09/24/persistent-true分析/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">persistent=&#34;true&#34;分析</h4>
      </a>
    </div>
  
</nav>



    




















</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        您的支持是我的动力
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/alipay.png" alt="打赏二维码">
        </div>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Wong Suechang &copy; 2019 - 2020</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://wongsuechang.github.io/2019/09/24/阿里Sophix热更新从入门到应用/&title=《阿里Sophix热更新从入门到应用》 — WongSuechang's Blogs&pic=http://wongsuechang.github.io/img/wongsuechang.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://wongsuechang.github.io/2019/09/24/阿里Sophix热更新从入门到应用/&title=《阿里Sophix热更新从入门到应用》 — WongSuechang's Blogs&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://wongsuechang.github.io/2019/09/24/阿里Sophix热更新从入门到应用/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《阿里Sophix热更新从入门到应用》 — WongSuechang's Blogs&url=http://wongsuechang.github.io/2019/09/24/阿里Sophix热更新从入门到应用/&via=http://wongsuechang.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://wongsuechang.github.io/2019/09/24/阿里Sophix热更新从入门到应用/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=http://wongsuechang.github.io/2019/09/24/阿里Sophix热更新从入门到应用/" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = 'Change no world.';
            clearTimeout(titleTime);
        } else {
            document.title = 'Write the code.';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
